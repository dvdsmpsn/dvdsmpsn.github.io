<html>
  <head>
    <!-- https://davidsimpson.me/labs/pii-viewer/mailchimp-example.html -->

    <style>
      body {
        font-family: sans-serif;
        font-size: 16px;
        max-width: 800px;
        margin: auto;
      }
      #mc {
        margin: 30px 0;
        font-size: 200%;
      }
    </style>
  </head>
  <body>
    <p>Hello world. Is this from Mailchimp?</p>
    <p id="mc">Your Mailchimp Email UID is <strong id="uid">not set</strong></p>
    <p>
      You can send Mailchimp Email UIDs in email shots by using the <code>*|EMAIL_UID|*</code> <a href="https://mailchimp.com/help/all-the-merge-tags-cheat-sheet/#API">merge tag</a> in a link URL. 
    </p>
    <p>
      If your Mailchimp Email UID is set, then it will be sent over to Google Analytics (GA4) by this page using the following code:
    </p>
    <pre>
      const mcid = new URLSearchParams(location.search).get('mcid');
      if (mcid) {
        gtag("event", "mailchimp_mailshot", {
          mcid: mcid,
        });
      }    
    </pre>
    <p>
      <a
        href="https://github.com/dvdsmpsn/dvdsmpsn.github.io/edit/master/labs/pii-viewer/mailchimp-example.html"
        >Edit this file</a
      >
    </p>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-2FH8CFVGBT"
    ></script>
    <script>
      //
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-2FH8CFVGBT"); // ********** My tag - use your own here

      const mcid = new URLSearchParams(location.search).get('mcid');

      if (mcid) {
        // it's from a mailchimp email campaign

        // display it on the page ;)
        const uidNode = document.querySelector("#uid");
        uidNode.innerHTML = mcid;

        // send it to Google Analytics
        // @see: https://support.google.com/analytics/answer/10075209
        gtag("event", "mailchimp_mailshot", {
          mcid: mcid,
        });
      }
    </script>
  </body>
</html>
